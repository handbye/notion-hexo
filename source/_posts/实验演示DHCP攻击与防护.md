---
permalink: 2019/07/03/dhcp-security
tags:
  - DHCP
layout: post
date: '2019-07-03 08:00:00'
categories:
  - ç½‘ç»œå®‰å…¨
home_cover: 'https://cdn.jsdelivr.net/gh/handbye/images/picgot0186e02da604a5a679.jpg'
title: å®éªŒæ¼”ç¤ºDHCPæ”»å‡»ä¸é˜²æŠ¤
---

å…³äºDHCPçš„å„ç§æ”»å‡»ä»‹ç»å¯å‚è€ƒä¹‹å‰çš„ä¸€ç¯‡æ–‡ç« [DHCP snoopingæ€»ç»“](https://darkless.cn/2018/06/18/DHCP-snooping-summary/),æœ¬æ–‡é‡ç‚¹ä»¥å®éªŒçš„æ–¹å¼æ¥æ¼”ç¤ºDHCPçš„æ”»å‡»ä¸é˜²å¾¡ğŸ˜Šã€‚


## å®éªŒæ‹“æ‰‘


![20190703233314.png](../post_images/ee6ad93d734f695909bc213c0fb0ced9.png)


å®éªŒæ¨¡æ‹Ÿå™¨ä½¿ç”¨çš„æ˜¯GNS3ï¼Œè·¯ç”±å™¨åŠäº¤æ¢æœºä¸ºæ€ç§‘è®¾å¤‡ï¼ŒDHCPæœåŠ¡å™¨ä¸ºwinserver2008,æ”»å‡»ç³»ç»Ÿä¸ºkali linuxã€‚


## å®éªŒæ€è·¯

1. å…ˆä½¿ç”¨kali linuxæ”»å‡»æ­£å¸¸çš„DHCPæœåŠ¡å™¨ä½¿å…¶åœ°å€è€—å°½
2. ä½¿ç”¨éæ³•DHCPæœåŠ¡å™¨ä¸ºå®¢æˆ·ç«¯åˆ†é…åœ°å€ï¼Œå¹¶å°†ç½‘å…³æŒ‡å‘kali
3. åœ¨kaliä¸Šé…ç½®è·¯ç”±ä½¿å¾—å®¢æˆ·ç«¯å¯ä»¥æ­£å¸¸ä¸Šç½‘ï¼ˆé˜²æ­¢å®¢æˆ·ç«¯ä¸èƒ½æ­£å¸¸ä¸Šç½‘å¼•èµ·æ€€ç–‘ï¼‰
4. åœ¨kaliä¸ŠæŠ“åŒ…å³å¯çœ‹åˆ°å®¢æˆ·ç«¯çš„æ‰€æœ‰æ•°æ®åŒ…ï¼ˆæœ€ç»ˆç›®çš„ï¼‰

## ä½¿ç”¨dhcpigæ”»å‡»æ­£å¸¸çš„DHCPæœåŠ¡å™¨


DHCPigå¯ä»¥å‘èµ·ä¸€ä¸ªé«˜çº§çš„DHCPè€—å°½æ”»å‡»ã€‚å®ƒå°†æ¶ˆè€—å±€åŸŸç½‘å†…çš„æ‰€æœ‰IPåœ°å€ä»¥åŠé˜»æ­¢æ–°å®¢æˆ·ç«¯è·å–IPï¼ŒåŒæ—¶å®ƒä¹Ÿé˜²æ­¢æ—§å®¢æˆ·ç«¯é‡Šæ”¾IPåœ°å€ã€‚å¦å¤–ï¼Œå®ƒä¼šå‘é€æ— æ•ˆçš„ARPå»æŠŠæ‰€æœ‰çš„windowsä¸»æœºéœ‡ä¸‹çº¿ã€‚å…³äºDHCPigçš„ä½¿ç”¨æ–¹æ³•è¯·å‚è€ƒï¼š[https://blog.csdn.net/qq_29277155/article/details/51712059](https://blog.csdn.net/qq_29277155/article/details/51712059)


å…ˆæŸ¥çœ‹ä¸‹å½“å‰DHCPæœåŠ¡å™¨çš„åœ°å€æ± æƒ…å†µï¼š


![20190703231704.png](../post_images/b8714640ebb5d0ddfa7a9aa5d128c339.png)


åœ°å€æ± ä¸­æœ‰10ä¸ªåœ°å€ã€‚


å‘èµ·æ”»å‡»ï¼š


![20190703222859.png](../post_images/8b838239db1162254f5e64e7e8402622.png)


æ”»å‡»å®Œæˆåå†æ¬¡æŸ¥çœ‹DHCPæœåŠ¡å™¨ç»Ÿè®¡æƒ…å†µï¼Œå‘ç°å·²ç»æ— åœ°å€å¯ç”¨ã€‚


![20190703223016.png](../post_images/a4230d1d1a631df7a6dc3b88d2ee95b8.png)


## å¯ç”¨éæ³•DHCPæœåŠ¡å™¨ä¸ºå®¢æˆ·ç«¯åˆ†é…åœ°å€


å¯çœ‹åˆ°clientå·²ç»è·å–åˆ°åœ°å€ï¼š


![20190703232647.png](../post_images/6f060f36f3bf9baca05c2133570b6d9e.png)


å¹¶ä¸”ç½‘å…³ä¸ºkali linuxçš„åœ°å€ï¼š


![20190703232804.png](../post_images/5e22501c396cb158731e021504ad1ec8.png)


ä¹Ÿå°±æ˜¯è¯´clientä¸Šç½‘çš„è¯å¿…é¡»ç»è¿‡kali linux


## åœ¨kaliä¸Šé…ç½®è·¯ç”±


åœ¨kaliä¸Šé…ç½®è·¯ç”±ä½¿å¾—clientèƒ½å¤Ÿè®¿é—®internetä¹Ÿå°±æ˜¯10.1.1.0ç½‘æ®µ


![20190703234401.png](../post_images/7f3221f933ce29920f6f22ba12f25359.png)


> _æ³¨æ„åœ¨ä¸ºkalié…ç½®è·¯ç”±å‰éœ€è¦å…ˆå¼€å¯kaliçš„è·¯ç”±è½¬å‘åŠŸèƒ½ï¼š  
> echo 1 > /proc/sys/net/ipv4/ipforward_


æ­¤æ—¶clientå³å¯è®¿é—®10.1.1.0ç½‘æ®µäº†ï¼š


![20190703234555.png](../post_images/68ce98b26a98134231926d45dc78b843.png)


## åœ¨kaliä¸ŠæŠ“åŒ…


DHCPæ”»å‡»çš„æœ€ç»ˆç›®çš„æ˜¯èƒ½å¤Ÿåœ¨kaliä¸ŠæŠ“åˆ°clientè®¿é—®internetçš„æ•°æ®åŒ….


åœ¨kaliä¸ŠæŠ“åŒ…ï¼š


![20190704000904.png](../post_images/79cc2ae5f3abae5644bf3b02336d5781.png)


å¯å®Œæ•´çš„æŸ¥çœ‹åˆ°clientè®¿é—®çš„æ•°æ®åŒ…ï¼Œè‡³æ­¤DHCPçš„æ”»å‡»å°±ç®—å®Œæˆäº†ã€‚æ¥ä¸‹æ¥è¯´è¯´æ€ä¹ˆé˜²å¾¡DHCPæ”»å‡»


## DHCPæ”»å‡»çš„é˜²å¾¡


DHCPæ”»å‡»çš„é˜²å¾¡åœ¨äº¤æ¢æœºä¸Šçš„å®ç°å¾ˆç®€å•ï¼Œåªéœ€è¦å¼€å¯DHCP snoopingåŠŸèƒ½å³å¯ï¼Œä¸‹é¢ä»¥æ€ç§‘äº¤æ¢æœºä¸ºä¾‹è¿›è¡Œé…ç½®ï¼š


```shell
ip dhcp snooping
ip dhcp snooping database disk0
interface e0/0
    ip dhcp snooping trust
interface e0/1
    ip dhcp snooping limit rate 2
ip dhcp snooping vlan 1

```


é…ç½®ä¸Šè¿°å‘½ä»¤åå³å¯é˜²å¾¡DHCPçš„æ”»å‡»ï¼Œä¸€æ—¦å‘ç”ŸDHCP DOSæ”»å‡»ï¼Œå¯¹åº”çš„æ¥å£ä¼šç›´æ¥shutdown,éœ€è¦æ‰‹å·¥upã€‚

